[gcode_macro G27]
gcode:
  {% set x = params.X|default(20)|float %}
  {% set y = params.Y|default(290)|float %}
  {% set z = params.Z|default(20)|float %}
  {% if printer.toolhead.homed_axes != "xyz" %}
    {action_respond_info("Please home XYZ first")}
  {% else %}
    SAVE_GCODE_STATE NAME=G27_state
    G91
    G1 Z{z}
    G90
    G1 X{x} Y{y} F3000
    RESTORE_GCODE_STATE NAME=G27_state MOVE=0
  {% endif %}
